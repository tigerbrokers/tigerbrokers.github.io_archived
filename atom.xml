<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>TigerFED</title>
  
  <subtitle>老虎证券桌面技术团队博客</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://tigerbrokers.github.io/"/>
  <updated>2018-02-07T08:52:13.675Z</updated>
  <id>http://tigerbrokers.github.io/</id>
  
  <author>
    <name>TigerFED</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>有关数据可视化学习</title>
    <link href="http://tigerbrokers.github.io/about-data-visiualization/"/>
    <id>http://tigerbrokers.github.io/about-data-visiualization/</id>
    <published>2018-02-07T08:39:22.000Z</published>
    <updated>2018-02-07T08:52:13.675Z</updated>
    
    <content type="html"><![CDATA[<!-- excerpt --></p><h1 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h1><p>数据可视化主要旨在借助于图形化手段，清晰有效地传达与沟通信息。</p><blockquote><p>数据可视化（Data Visualization）和 信息可视化（Information Visualization）是两个相近的专业领域名词。狭义上的数据可视化指的是将数据用统计图表方式呈现，而信息可视化则是将非数字的信息进行可视化。前者用于传递信息，后者用于表现抽象或复杂的概念、技术和信息。而广义上的数据可视化则是数据可视化、信息可视化以及科学可视化等等多个领域的统称。<br>——《数据可视化之美》</p></blockquote><h1 id="基础概念"><a href="#基础概念" class="headerlink" title="基础概念"></a>基础概念</h1><ol><li>维度</li><li>维度类型和转换</li></ol><h1 id="数据可视化技术栈"><a href="#数据可视化技术栈" class="headerlink" title="数据可视化技术栈"></a>数据可视化技术栈</h1><ul><li>基础数学：三角函数、线性代数、几何算法</li><li>图形相关：canvas、svg、webgl、计算图形学、图论</li><li>工程算法：基础算法、统计算法、常用的布局算法</li><li>数据分析：数据清洗、统计学、数据建模</li><li>设计美学：设计原则、美学评判、颜色、交互、认知</li><li>可视化基础：可视化编码、可视分析、图形交互</li><li>可视化解决方案：图表的正确使用、常见的业务的可视化场景</li></ul><h1 id="基于Web的数据可视化技术"><a href="#基于Web的数据可视化技术" class="headerlink" title="基于Web的数据可视化技术"></a>基于Web的数据可视化技术</h1><h2 id="底层技术规范"><a href="#底层技术规范" class="headerlink" title="底层技术规范"></a>底层技术规范</h2><ol><li>SVG：可缩放矢量图形（Scalable Vector Graphics），是基于可扩展标记语言（标准通用标记语言的子集）用于描述二维矢量图形的一种图形格式。</li><li>Canvas 2D：Canvas 通过 JavaScript 来绘制 2D 图形，通过逐像素来进行渲染。</li><li>Canvas 3D WebGL：WebGL（Web Graphic Library）是一个 JavaScript API，用于在任何兼容的 Web 浏览器中渲染 3D 图形。WebGL 程序由用 JavaScript 编写的控制代码和用 OpenGL 着色语言（GLSL）编写的着色器代码构成，这种语言类似于 C 或 C++，可在 GPU 上执行。</li></ol><p>比较流行的基础绘图库，基于 SVG 的有 snap.svg、rapheal.js 等，基于 Canvas 2D 的有 zrender、g 等，基于 WebGL 的有 three.js、SceneJS、PhiloGL 等，这些基础绘图库可以让上层封装更简单容易。</p><h2 id="Web数据可视化类库"><a href="#Web数据可视化类库" class="headerlink" title="Web数据可视化类库"></a>Web数据可视化类库</h2><ul><li>D3</li><li>Highcharts</li><li>ECharts</li></ul><h1 id="如何选择图表"><a href="#如何选择图表" class="headerlink" title="如何选择图表"></a>如何选择图表</h1><p><img src="/assets/images/15179928837522.jpg" alt=""></p><h1 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h1><h2 id="数据分析师技能"><a href="#数据分析师技能" class="headerlink" title="数据分析师技能"></a>数据分析师技能</h2><ol><li>用熟Excel</li><li>数据可视化<ol><li>图表选择</li><li>报表制作</li><li>信息图和BI系统</li></ol></li><li>分析思维的训练<ol><li>金字塔原理</li><li>掌握思考框架：SMART, 5W2H, SWOT, 4P，六顶思考帽</li></ol></li><li>数据库学习<ol><li>SQL语言掌握</li><li>MapReduce原理</li></ol></li><li>统计知识学习<ol><li>均值、中位数、标准差、方差、概率</li><li>假设检验、显著性、总体和抽样</li><li>数据推导</li></ol></li><li>业务学习<ol><li>用户行为</li><li>产品和运营相关，如行业指标：活跃用户数，洛用户率，留存率，流失率，传播系数等</li></ol></li><li>Python/R语言学习<ol><li>数据挖掘</li><li>爬虫</li><li>可视化报表</li></ol></li></ol><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://antv.alipay.com/zh-cn/vis/blog/vis-introduce.html" target="_blank" rel="noopener">https://antv.alipay.com/zh-cn/vis/blog/vis-introduce.html</a><br><a href="https://zh.wikipedia.org/wiki/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96" target="_blank" rel="noopener">https://zh.wikipedia.org/wiki/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96</a><br><a href="https://www.zhihu.com/question/19929609" target="_blank" rel="noopener">https://www.zhihu.com/question/19929609</a><br><a href="http://www.cbdio.com/BigData/2017-06/02/content_5531235.htm" target="_blank" rel="noopener">http://www.cbdio.com/BigData/2017-06/02/content_5531235.htm</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;数据可视化（Data Visualization）和 信息可视化（Information Visualization）是两个相近的专业领域名词。狭义上的数据可视化指的是将数据用统计图表方式呈现，而信息可视化则是将非数字的信息进行可视化。前者用于传递信息，后者用于表现抽象或复杂的概念、技术和信息。而广义上的数据可视化则是数据可视化、信息可视化以及科学可视化等等多个领域的统称。&lt;br&gt;
    
    </summary>
    
    
      <category term="data" scheme="http://tigerbrokers.github.io/tags/data/"/>
    
      <category term="d3" scheme="http://tigerbrokers.github.io/tags/d3/"/>
    
      <category term="chart" scheme="http://tigerbrokers.github.io/tags/chart/"/>
    
      <category term="visualization" scheme="http://tigerbrokers.github.io/tags/visualization/"/>
    
  </entry>
  
  <entry>
    <title>有关跨域 CORS 及 Nginx 配置</title>
    <link href="http://tigerbrokers.github.io/about-cors-and-nginx/"/>
    <id>http://tigerbrokers.github.io/about-cors-and-nginx/</id>
    <published>2018-02-06T06:28:58.000Z</published>
    <updated>2018-02-07T08:52:13.675Z</updated>
    
    <content type="html"><![CDATA[<!-- excerpt --></p><h1 id="什么是跨域？"><a href="#什么是跨域？" class="headerlink" title="什么是跨域？"></a>什么是跨域？</h1><p>跨域请求针对浏览器的同源策略(Same-Origin Policy)而言，指一个网站主动请求另外一个网站的资源(图片、javascript、视频等)。</p><p>同源策略要求网站只能有限制的访问外部网站的资源，不合法的请求会被拦截。网站的源由协议、域名、端口三部分组成，有一部分不同就被视为不同源，两个不同的域名即便指向同一个ip地址也是跨域的。网站通过AJAX请求资源是典型的跨域请求，需要外部网站许可才能访问。</p><p>同源策略是浏览器端的安全限制。</p><a id="more"></a><p><img src="/assets/images/15178986212867.jpg" alt=""></p><blockquote><p>“Domains, protocols and ports must match”</p></blockquote><h1 id="跨域对前端的影响"><a href="#跨域对前端的影响" class="headerlink" title="跨域对前端的影响"></a>跨域对前端的影响</h1><ul><li>AJAX：请求无法发送和接收</li><li>WebFonts：字体文件无法从别的域加载</li><li>SVG：通过use引用的外部资源无法使用</li><li>Canvas/WebGL：如无法读取图片的点阵数据，无法toDateURL等</li><li>Video：无法截取快照</li></ul><p>通常浏览器控制台会明确打印出跨域错误及其帮助信息，如：</p><p><img src="/assets/images/15178986972043.jpg" alt=""></p><h1 id="CORS的浏览器支持"><a href="#CORS的浏览器支持" class="headerlink" title="CORS的浏览器支持"></a>CORS的浏览器支持</h1><p><img src="/assets/images/15178987236463.jpg" alt=""></p><p>基本主流浏览器都已经支持。</p><h1 id="跨域请求过程"><a href="#跨域请求过程" class="headerlink" title="跨域请求过程"></a>跨域请求过程</h1><p><img src="/assets/images/15178987563714.jpg" alt=""></p><ol><li>首先查看http头部有无origin字段；</li><li>如果没有，或者不允许，直接当成普通请求处理，结束；</li><li>如果有并且是允许的，那么再看是否是preflight(method=OPTIONS)；</li><li>如果是preflight，就返回Allow-Headers、Allow-Methods等，内容为空；</li><li>如果不是preflight，就返回Allow-Origin、Allow-Credentials等，并返回正常内容。</li></ol><h2 id="简单请求-Simple-Request"><a href="#简单请求-Simple-Request" class="headerlink" title="简单请求(Simple Request)"></a>简单请求(Simple Request)</h2><p>GET, HEAD, POST 方法，并且POST方法的Content-Type只包含 text/plain, application/x-www-form-urlencoded, multipart/form-data</p><h2 id="预请求-Preflighted-Request"><a href="#预请求-Preflighted-Request" class="headerlink" title="预请求(Preflighted Request)"></a>预请求(Preflighted Request)</h2><p>在简单请求之外的其它请求发出前，都会先发一个OPTION请求，以探测服务器是否支持及允许CORS请求的配置参数。</p><blockquote><p>我们的大多数AJAX请求包含Authentication头，因此这些都不会是简单请求，所有请求都需要先发一个预请求。</p></blockquote><h1 id="跨域相关HTTP-Headers"><a href="#跨域相关HTTP-Headers" class="headerlink" title="跨域相关HTTP Headers"></a>跨域相关HTTP Headers</h1><h2 id="相关Headers介绍"><a href="#相关Headers介绍" class="headerlink" title="相关Headers介绍"></a>相关Headers介绍</h2><p><img src="/assets/images/15179074088703.jpg" alt=""></p><ul><li>请求头都是由浏览器自动生成的，根据请求的不是当前域进行判断。</li><li>服务器端需要支持OPTION请求，并返回204</li><li>其它请求服务器端需要添加http headers即可，所有验证逻辑均在浏览器端完成。</li></ul><h2 id="支持Cookies的跨域"><a href="#支持Cookies的跨域" class="headerlink" title="支持Cookies的跨域"></a>支持Cookies的跨域</h2><p>若接口（比如<a href="http://api.com/ping）需要在自己域（http://api.com）下读写Cookies" target="_blank" rel="noopener">http://api.com/ping）需要在自己域（http://api.com）下读写Cookies</a>, 在没有 <code>Access-Control-Allow-Credentials: true</code> 的请求中，Cookies是不支持的，即 接口不能够读写域下的Cookies 。</p><p>因此要支持Cookies的跨域，需要服务器端返回如下头：<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">//</span> <span class="string">OPTION</span> <span class="string">Request</span></span><br><span class="line"><span class="string">OPTIONS</span> <span class="string">/api/v1/captcha?deviceId=web20180110_71007&amp;platform=desktop-web&amp;env=Chrome&amp;vendor=web&amp;lang=&amp;appVer=4.0.0</span> <span class="string">HTTP/1.1</span></span><br><span class="line"><span class="attr">Host:</span> <span class="string">test-oauth.itiger.com</span></span><br><span class="line"><span class="attr">Access-Control-Request-Method:</span> <span class="string">GET</span></span><br><span class="line"><span class="attr">Origin:</span> <span class="attr">https://test-web.itiger.com</span></span><br><span class="line"><span class="attr">Access-Control-Request-Headers:</span> <span class="string">authorization</span></span><br><span class="line"><span class="attr">Accept:</span> <span class="string">*/*</span></span><br><span class="line"><span class="attr">Accept-Encoding:</span> <span class="string">gzip,</span> <span class="string">deflate,</span> <span class="string">br</span></span><br><span class="line"><span class="attr">Accept-Language:</span> <span class="string">zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">//</span> <span class="string">OPTION</span> <span class="string">Response</span></span><br><span class="line"><span class="string">HTTP/1.1</span> <span class="number">204</span> <span class="literal">No</span> <span class="string">Content</span></span><br><span class="line"><span class="attr">Date:</span> <span class="string">Wed,</span> <span class="number">10</span> <span class="string">Jan</span> <span class="number">2018</span> <span class="number">09</span><span class="string">:13:22</span> <span class="string">GMT</span></span><br><span class="line"><span class="attr">Content-Type:</span> <span class="string">text/plain</span> <span class="string">charset=UTF-8</span></span><br><span class="line"><span class="attr">Connection:</span> <span class="string">keep-alive</span></span><br><span class="line"><span class="attr">Server:</span> <span class="string">nginx/1.9.6</span></span><br><span class="line"><span class="attr">Access-Control-Allow-Origin:</span> <span class="attr">https://test-web.itiger.com</span></span><br><span class="line"><span class="attr">Access-Control-Allow-Credentials:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">Access-Control-Allow-Methods:</span> <span class="string">POST,</span> <span class="string">GET,</span> <span class="string">OPTIONS,</span> <span class="string">HEAD,</span> <span class="string">DELETE,</span> <span class="string">PUT</span></span><br><span class="line"><span class="attr">Access-Control-Allow-Headers:</span> <span class="string">DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">//</span> <span class="string">GET</span> <span class="string">Request</span></span><br><span class="line"><span class="string">GET</span> <span class="string">/api/v1/captcha?deviceId=web20180110_71007&amp;platform=desktop-web&amp;env=Chrome&amp;vendor=web&amp;lang=&amp;appVer=4.0.0</span> <span class="string">HTTP/1.1</span></span><br><span class="line"><span class="attr">Host:</span> <span class="string">test-oauth.itiger.com</span></span><br><span class="line"><span class="attr">Connection:</span> <span class="string">keep-alive</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Accept:</span> <span class="string">application/json,</span> <span class="string">text/plain,</span> <span class="string">*/*</span></span><br><span class="line"><span class="attr">Origin:</span> <span class="attr">https://test-web.itiger.com</span></span><br><span class="line"><span class="attr">Authorization:</span> <span class="string">Bearer</span> <span class="string">gMnH2uCUzsoncdiC90XJaYDpoYgxDYiBMydIUGfC9NDkfSiiD0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">//</span> <span class="string">GET</span> <span class="string">Response</span></span><br><span class="line"><span class="string">HTTP/1.1</span> <span class="number">200</span> <span class="string">OK</span></span><br><span class="line"><span class="attr">Date:</span> <span class="string">Wed,</span> <span class="number">10</span> <span class="string">Jan</span> <span class="number">2018</span> <span class="number">09</span><span class="string">:16:19</span> <span class="string">GMT</span></span><br><span class="line"><span class="attr">Content-Type:</span> <span class="string">application/json</span></span><br><span class="line"><span class="attr">Transfer-Encoding:</span> <span class="string">chunked</span></span><br><span class="line"><span class="attr">Connection:</span> <span class="string">keep-alive</span></span><br><span class="line"><span class="attr">Vary:</span> <span class="string">Accept-Encoding</span></span><br><span class="line"><span class="attr">Server:</span> <span class="string">TornadoServer/3.2.2</span></span><br><span class="line"><span class="attr">Etag:</span> <span class="string">W/"d8b94d7da2b3d9cec8a195d024dea7147a470d4b"</span></span><br><span class="line"><span class="attr">Pragma:</span> <span class="literal">no</span><span class="bullet">-store</span></span><br><span class="line"><span class="attr">Cache-Control:</span> <span class="literal">no</span><span class="bullet">-store</span></span><br><span class="line"><span class="attr">Set-Cookie:</span> <span class="string">captcha="2|1:0|10:1515575779|7:captcha|88:NDdkNmYzYjYwMzQ5N2ViNTU0YjQ0YmEyNTY3MDVjZmVkMWNmZTc1ODRmNzNiNGNjN2M1Yzc5Mzg4MjE0YTg3Yg==|7fe5bc2d6d748af5fd3442a09ad07f8d819db249e0c13d1047e1411611e25878";</span> <span class="string">expires=Fri,</span> <span class="number">09</span> <span class="string">Feb</span> <span class="number">2018</span> <span class="number">09</span><span class="string">:16:19</span> <span class="string">GMT;</span> <span class="string">Path=/</span></span><br><span class="line"><span class="attr">Access-Control-Allow-Origin:</span> <span class="attr">https://test-web.itiger.com</span></span><br><span class="line"><span class="attr">Access-Control-Allow-Credentials:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">Access-Control-Allow-Methods:</span> <span class="string">POST,</span> <span class="string">GET,</span> <span class="string">OPTIONS,</span> <span class="string">HEAD,</span> <span class="string">DELETE,</span> <span class="string">PUT</span></span><br><span class="line"><span class="attr">Access-Control-Allow-Headers:</span> <span class="string">Referer,Accept,Origin,User-Agent,Authorization,NT,X-CustomHeader,Keep-Alive,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Connection,DNT</span></span><br><span class="line"><span class="attr">Content-Encoding:</span> <span class="string">gzip</span></span><br></pre></td></tr></table></figure></p><p>除此之外，前端在进行请求时需要特别标注：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Vanilla</span></span><br><span class="line"><span class="keyword">let</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">xhr.withCredentials = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// JQuery</span></span><br><span class="line">$.ajax(&#123;</span><br><span class="line">    type: <span class="string">'POST'</span>,</span><br><span class="line">    data: &#123;&#125;,</span><br><span class="line">    dataType: <span class="string">'json'</span>,</span><br><span class="line">    xhrFields: &#123;</span><br><span class="line">       withCredentials: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Vue-resource</span></span><br><span class="line"><span class="keyword">const</span> result = <span class="keyword">await</span> <span class="keyword">this</span>.$http.get(url, &#123;</span><br><span class="line">  credentials: <span class="literal">true</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="调试CORS请求问题"><a href="#调试CORS请求问题" class="headerlink" title="调试CORS请求问题"></a>调试CORS请求问题</h1><p>主要有两种方法：</p><h2 id="简单判定是否CORS问题，"><a href="#简单判定是否CORS问题，" class="headerlink" title="简单判定是否CORS问题，"></a>简单判定是否CORS问题，</h2><ol><li>查看控制台出错日志信息</li><li>下载 <a href="https://chrome.google.com/webstore/detail/nlfbmbojpeacfghkpbjhddihlkkiljbi" target="_blank" rel="noopener">CORS 调试</a>  浏览器插件，开启后重新请求</li></ol><p><img src="/assets/images/15179075649303.jpg" alt=""></p><blockquote><p>注意：<br>开启并用默认配置(<em>://</em>)，可能会导致某些网站访问异常，如GitHub。建议自行添加过滤。<br>此种方法也适用于开发时调用暂未配置跨域的接口。</p></blockquote><h2 id="用Charles修改HTTP请求调试"><a href="#用Charles修改HTTP请求调试" class="headerlink" title="用Charles修改HTTP请求调试"></a>用Charles修改HTTP请求调试</h2><h1 id="Nginx-配置参考"><a href="#Nginx-配置参考" class="headerlink" title="Nginx 配置参考"></a>Nginx 配置参考</h1><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">map</span> <span class="variable">$http_origin</span> <span class="variable">$allow_origin</span> &#123;</span><br><span class="line">  <span class="attribute">default</span> <span class="string">""</span>;</span><br><span class="line">  "~^https?://(?:[^/]*\.)?(stevebuzonas\.(?:com|local))(?::[0-9]+)?$" "$http_origin";</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="attribute">map</span> <span class="variable">$request_method</span> <span class="variable">$cors_method</span> &#123;</span><br><span class="line">  <span class="attribute">default</span> <span class="string">"allowed"</span>;</span><br><span class="line">  "OPTIONS" "preflight";</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="attribute">map</span> <span class="variable">$cors_method</span> <span class="variable">$cors_max_age</span> &#123;</span><br><span class="line">  <span class="attribute">default</span> <span class="string">""</span>;</span><br><span class="line">  "preflight" 1728000;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="attribute">map</span> <span class="variable">$cors_method</span> <span class="variable">$cors_allow_methods</span> &#123;</span><br><span class="line">  <span class="attribute">default</span> <span class="string">""</span>;</span><br><span class="line">  "preflight" "GET, POST, OPTIONS";</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="attribute">map</span> <span class="variable">$cors_method</span> <span class="variable">$cors_allow_headers</span> &#123;</span><br><span class="line">  <span class="attribute">default</span> <span class="string">""</span>;</span><br><span class="line">  "preflight" "Authorization,Content-Type,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,Authorization";</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="attribute">map</span> <span class="variable">$cors_method</span> <span class="variable">$cors_content_length</span> &#123;</span><br><span class="line">  <span class="attribute">default</span> <span class="variable">$initial_content_length</span>;</span><br><span class="line">  "preflight" 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="attribute">map</span> <span class="variable">$cors_method</span> <span class="variable">$cors_content_type</span> &#123;</span><br><span class="line">  <span class="attribute">default</span> <span class="variable">$initial_content_type</span>;</span><br><span class="line">  "preflight" "text/plain charset=UTF-8";</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="attribute">add_header</span> Access-Control-Allow-Origin <span class="variable">$allow_origin</span> always;</span><br><span class="line"><span class="attribute">add_header</span> Access-Control-Allow-Credentials <span class="string">'true'</span> always;</span><br><span class="line"><span class="attribute">add_header</span> Access-Control-Max-Age <span class="variable">$cors_max_age</span> always;</span><br><span class="line"><span class="attribute">add_header</span> Access-Control-Allow-Methods <span class="variable">$cors_allow_methods</span> always;</span><br><span class="line"><span class="attribute">add_header</span> Access-Control-Allow-Headers <span class="variable">$cors_allow_headers</span> always;</span><br><span class="line"></span><br><span class="line"><span class="attribute">set</span> <span class="variable">$initial_content_length</span> <span class="variable">$sent_http_content_length</span>;</span><br><span class="line"><span class="attribute">add_header</span> <span class="string">'Content-Length'</span> <span class="string">""</span>;</span><br><span class="line"><span class="attribute">add_header</span> <span class="string">'Content-Length'</span> <span class="variable">$cors_content_length</span>;</span><br><span class="line"></span><br><span class="line"><span class="attribute">set</span> <span class="variable">$initial_content_type</span> <span class="variable">$sent_http_content_type</span>;</span><br><span class="line"><span class="attribute">add_header</span> Content-Type <span class="string">""</span>;</span><br><span class="line"><span class="attribute">add_header</span> Content-Type <span class="variable">$cors_content_type</span>;</span><br><span class="line"></span><br><span class="line"><span class="attribute">if</span> (<span class="variable">$request_method</span> = <span class="string">'OPTIONS'</span>) &#123;</span><br><span class="line">  <span class="attribute">return</span> <span class="number">204</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意：</p><ol><li>相关Access-Control的add_header后加了<code>always</code>，因为默认情况下，<code>add_header</code>只作用于状态码为 200, 201 (1.3.10), 204, 206, 301, 302, 303, 304, 307 (1.1.16, 1.0.13), or 308 (1.13.0) 之中的响应，并不支持40x,50x等，因此添加<code>always</code>可以支持所有状态码。 见：<a href="http://nginx.org/en/docs/http/ngx_http_headers_module.html#add_header" target="_blank" rel="noopener">http://nginx.org/en/docs/http/ngx_http_headers_module.html#add_header</a></li><li>之所以用<code>map</code>命令而不是<code>if</code>，是由于if其实是归属于nginx_rewrite模块的，对于<code>try_files</code>等会不支持，Nginx官方也并不建议使用<code>if</code>。见：<a href="https://www.nginx.com/resources/wiki/start/topics/depth/ifisevil/" target="_blank" rel="noopener">https://www.nginx.com/resources/wiki/start/topics/depth/ifisevil/</a></li><li>以上<code>nginx-cors.conf</code>可如下方式使用：<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line">  <span class="attribute">include</span> ./nginx-cors.conf;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="attribute">proxy_pass</span> http://127.0.0.1:4000;</span><br><span class="line">  <span class="attribute">proxy_set_http_header</span> HOST <span class="variable">$http_host</span>;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h1 id="参考资源"><a href="#参考资源" class="headerlink" title="参考资源"></a>参考资源</h1><ul><li><a href="https://www.w3.org/TR/cors/" target="_blank" rel="noopener">https://www.w3.org/TR/cors/</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS</a></li><li><a href="https://www.test-cors.org/" target="_blank" rel="noopener">https://www.test-cors.org/</a></li><li><a href="https://enable-cors.org/index.html" target="_blank" rel="noopener">https://enable-cors.org/index.html</a></li><li><a href="https://www.html5rocks.com/en/tutorials/cors/" target="_blank" rel="noopener">https://www.html5rocks.com/en/tutorials/cors/</a><h1 id="扩展知识"><a href="#扩展知识" class="headerlink" title="扩展知识"></a>扩展知识</h1></li><li>HTTPS</li><li>Nginx</li><li>CSP</li><li>HTTP/1.1 vs HTTP2</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;跨域请求针对浏览器的同源策略(Same-Origin Policy)而言，指一个网站主动请求另外一个网站的资源(图片、javascript、视频等)。&lt;/p&gt;
&lt;p&gt;同源策略要求网站只能有限制的访问外部网站的资源，不合法的请求会被拦截。网站的源由协议、域名、端口三部分组成，有一部分不同就被视为不同源，两个不同的域名即便指向同一个ip地址也是跨域的。网站通过AJAX请求资源是典型的跨域请求，需要外部网站许可才能访问。&lt;br&gt;
    
    </summary>
    
    
      <category term="cors" scheme="http://tigerbrokers.github.io/tags/cors/"/>
    
      <category term="nginx" scheme="http://tigerbrokers.github.io/tags/nginx/"/>
    
      <category term="http" scheme="http://tigerbrokers.github.io/tags/http/"/>
    
  </entry>
  
</feed>
